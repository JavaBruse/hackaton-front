<section>
    <!-- –∑–æ–Ω–∞ drag&drop -->
    <div class="drop-zone" (dragover)="allowDrop($event)" (dragleave)="onDragLeave()" (drop)="onFileDropped($event)"
        [class.drag-over]="dragOver">
        <p>–ü–µ—Ä–µ—Ç–∞—â–∏—Ç–µ —Ñ–∞–π–ª—ã —Å—é–¥–∞ –∏–ª–∏ –≤—ã–±–µ—Ä–∏—Ç–µ –≤—Ä—É—á–Ω—É—é</p>
        <input type="file" (change)="onFileSelected($event)" multiple accept="image/*,.zip" style="display: none;"
            #fileInput>
        <button matButton="elevated" (click)="fileInput.click()">–í—ã–±—Ä–∞—Ç—å —Ñ–∞–π–ª—ã</button>
    </div>

    @if (files.length > 0) {
    <button matButton="elevated" class="send-button" (click)="onUpload()" [disabled]="uploading">–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
    }
    <!-- —Å–ø–∏—Å–æ–∫ —Ñ–∞–π–ª–æ–≤ -->
    @if (files.length > 0) {
    <h3>–§–∞–π–ª—ã:</h3>
    <ul>
        @for (f of files; track f.file.name; let i = $index) {
        <li class="file-item">
            @if (f.isImage) {
            <div class="file-row">
                <img [src]="f.preview" alt="preview" class="thumb" />
                <span class="file-info">
                    <strong>{{ f.file.name }}</strong>
                    <div class="size">{{ formatSize(f.file.size) }}</div>
                </span>
                <button matButton="elevated" (click)="showPreview(f)">–ü—Ä–æ—Å–º–æ—Ç—Ä</button>
                <button matButton="elevated" (click)="removeFile(i)">–£–¥–∞–ª–∏—Ç—å</button>
            </div>
            } @else {
            <div class="file-row">
                <span class="file-info">üì¶ <strong>{{ f.file.name }}</strong>
                    <div class="size">{{ formatSize(f.file.size) }}</div>
                </span>
                <button matButton="elevated" (click)="removeFile(i)">–£–¥–∞–ª–∏—Ç—å</button>
            </div>
            }

            <!-- –ø—Ä–æ–≥—Ä–µ—Å—Å –ø–æ–¥ —Ñ–∞–π–ª–æ–º -->
            <div class="progress-row">
                <div class="progress-bar">
                    <div class="progress" [style.width.%]="f.progress"></div>
                </div>
                <div class="percent">{{ f.progress }}%</div>
            </div>

            <!-- –æ—à–∏–±–∫–∞ –µ—Å–ª–∏ –µ—Å—Ç—å -->
            @if (f.error) {
            <div class="upload-error">–û—à–∏–±–∫–∞: {{ f.error }}</div>
            }
        </li>
        }
    </ul>
    }

    <!-- overlay –ø—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä -->
    @if (previewImage) {
    <div class="overlay" (click)="closePreview()">
        <img [src]="previewImage" class="preview-image" />
    </div>
    }

    <!-- –∑–∞—Ç–µ–º–Ω–µ–Ω–∏–µ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ –∑–∞–≥—Ä—É–∑–∫–∏ (–±–µ–∑ –∫—Ä—É—Ç—è—â–µ–≥–æ—Å—è –∫—Ä—É–≥–∞) -->
    @if (uploading) {
    <div class="overlay">
        <div class="progress-counter">
            {{ uploadedCount }} / {{ files.length }}
        </div>
    </div>
    }
</section>